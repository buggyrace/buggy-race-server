{% extends "layout.html" %}
{% block content %}
{%include "admin/_nav.html" %}
<div class="container pb-5">
  <div class="row">
    <h1 class="col">Configuration settings</h1>
  </div>
  <div class="row">
    <div class="col">
      <p class="btn-collection">
        <a class="btn {% if tech_notes_timestamp %}btn-outline-secondary {% else %}btn-outline-danger{% endif %} btn-admin" href="{{ url_for('admin.tech_notes_admin')}}">Tech notes &rtri;</a>
        <a class="btn btn-outline-secondary btn-admin" href="{{ url_for('admin.tasks_admin')}}">Tasks &rtri;</a>
      </p>
    </div>
  </div>
  <div class="row js-only" id="show-settings-btns">
    <div class="col">
      <p class="btn-collection">
        {% for name in sorted_groupnames %}
          {% if group_name == name | lower %}
            {% set btn_class = "btn-dark" %}
          {% else %}
            {% set btn_class = "btn-outline-secondary" %}
          {% endif %}
          <a href="{{ url_for('admin.settings', group_name=name | lower) }}"
          class="btn {{ btn_class }}">{{ name | title }}</a>
        {% endfor %}
      </p>
    </div>
  </div>
  {% for group in sorted_groupnames %}
    {% if group_name == None or group_name == group | lower %}
      <div class="my-4 p-2 grey-wrapper" id="form-{{ group | lower }}">
        <form action="{{ url_for('admin.settings', group_name=group | lower) }}" method="post">
          {{ form.csrf_token }}
          <input type="hidden" name="group" value="{{ group }}"/>
          {% if group == "AUTH" %}
            <h3>Change authorisation code</h3>
            <div class="row py-2 m-1 bg-white">
              <div class="col-sm-3">
                New auth code
              </div>
              <div class="col-sm-4">
                <input name="{{ SETTING_PREFIX }}-0-name" type="hidden" value="AUTHORISATION_CODE" />
                <input name="{{ SETTING_PREFIX }}-0-value" type="password"  class="form-control mr-sm-1"/>
              </div>
              <div class="col-sm-5">
                Do not forget the auth code you have set!
              </div>
            </div>
            <div class="row bg-warning py-2 m-1">
              <div class="col-sm-3">
                <label for="auth_code">Auth code</label>
              </div>
              <div class="col-sm-4">
                <input id="auth_code" name="auth_code" type="password" value=""  class="form-control mr-sm-1"/>
              </div>
              <div class="col-sm-5">
                You must provide the current authorisation code to make changes.
              </div>
            </div>
            <input type="submit" class="btn btn-primary m-2" value="Submit new code"/>
          {% else %}
            <h3>{{ group | title }} settings</h3>

            {% if group == 'SOCIAL' %}
              {%include "admin/_social_settings.html" %}
            {% else %}
              {% for name in groups[group] %}
                <div class="row py-2 m-1 bg-white">
                  <div class="col-sm-3">
                    <label for="{{ SETTING_PREFIX }}-{{ loop.index0 }}-name"><code>{{ name }}</code></label>
                  </div>
                  <div class="col-sm-4">
                    <input type="hidden" name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-name" value="{{ name }}"/>
                    {%if name == "PROJECT_REPORT_TYPE" %}
                      {%include "admin/_report_type_input.html" %}
                    {% elif type_of_settings[name] == "bool" %}
                      <select name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-value" class="form-control">
                        <option value="0" {% if settings[name] == "0" %} selected="selected" {% endif %}>No</option>
                        <option value="1" {% if settings[name] == "1" %} selected="selected" {% endif %}>Yes</option>
                      </select>
                    {% else %}
                      <input name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-value" class="form-control mr-sm-1" 
                      {% if type_of_settings[name] == "int" %}
                          type="number"
                      {% elif type_of_settings[name] == "pass"%}
                          type="password"
                      {% elif type_of_settings[name] == "datetime"%}
                          type="datetime-local"
                      {% else %}
                          type="text"
                      {% endif %}
                      {%if settings[name] %} value="{{ settings[name] }}" {% endif %}
                      />
                    {% endif %}
                  </div>
                  <div class="col-sm-5">
                    {{ html_descriptions[name] | safe }}
                    <div class="setting-default">
                      {% if name == "ADMIN_USERNAMES" %}
                        <em>Currently:</em> <strong>must</strong> include <code>{{ current_user.username }}</code>
                      {% else %}
                        <em>Default:</em> <code>{{ pretty_default_settings[name] }}</code>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% endif %}
            <div class="row bg-warning py-2 m-1">
              <div class="col-sm-3">
                Auth code
              </div>
              <div class="col-sm-4">
                <input id="auth_code" name="auth_code" type="password" value="" class="form-control mr-sm-1"/>
              </div>
              <div class="col-sm-5">
                You must provide the current authorisation code to make changes.
              </div>
            </div>
            <input type="submit" class="btn btn-primary m-2" value="Submit {{ group | title }} settings"/>
          {% endif %}
        </form>
      </div>
    {% endif %}
  {% endfor %}
</div>
{% endblock %}

