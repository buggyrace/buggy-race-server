{% extends "layout.html" %}
{% block content %}
{%include "admin/_nav.html" %}
<div class="container pb-5">
  <div class="row">
    <h1 class="mt-5">Admin dashboard</h1>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <table class="table table-striped table-bordered table-hover">
        <tr>
          <td colspan="2">Students</td>
          <td class="text-right">{{ qty_students_active }}</td>
        </tr>
        <tr>
          <td>Logged in today</td>
          <td class="text-right">
            {% if qty_students_active > 0 %}
              {{ (100 * qty_students_logged_in_today/qty_students_active) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_students_logged_in_today }}</td>
        </tr>
        {% if students_logged_in_today %}
          <tr>
            <td colspan="3">
              <ul class="user-list">
                {% for s in students_logged_in_today %}
                  <li>{{ s.pretty_username }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        {% endif %}
        <tr>
          <td>Logged in last 7 days</td>
          <td class="text-right">
            {% if qty_students_active > 0 %}
              {{ (100 * qty_students_logged_in_this_week/qty_students_active) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_students_logged_in_this_week }}</td>
        </tr>
        {% if students_logged_in_this_week %}
          <tr>
            <td colspan="3">
              <ul class="user-list">
                {% for s in students_logged_in_this_week %}
                  <li>{{ s.pretty_username }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        {% endif %}
        <tr>
          <td>Never logged in</td>
          <td class="text-right">
            {% if qty_students_never_logged_in > 0 %}
              {{ (100 * qty_students_never_logged_in/qty_students_active) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_students_never_logged_in }}</td>
        </tr>
        {% if students_never_logged_in %}
          <tr>
            <td colspan="3">
              <ul class="user-list">
                {% for u in students_never_logged_in %}
                  <li>{{ u.pretty_username }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        {% endif %}


        <tr>
          <td colspan="2">Deactivated users</td>
          <td class="text-right">{{ qty_users_deactivated }} </td>
        </tr>
        {% if users_deactivated %}
          <tr>
            <td colspan="3">
              <ul class="user-list">
                {% for u in users_deactivated %}
                  <li>{{ u.pretty_username }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        {% endif %}
        <tr>
          <td colspan="2">Admin users</td>
          <td class="text-right">{{ qty_admin_users }}</td>
        </tr>
        <tr>
          <td colspan="3">
            <ul class="user-list">
              {% for u in admin_users %}
                <li>{{ u.pretty_username }}</li>
              {% endfor %}
            </ul>
          </td>
        </tr>
        {% if qty_other_users %}
          <tr>
            <td colspan="2">Other users (e.g. guests)</td>
            <td class="text-right">{{ qty_other_users }}</td>
          </tr>
          <tr>
            <td colspan="3">
              <ul class="user-list">
                {% for u in other_users %}
                  <li>{{ u.pretty_username }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        {% endif %}
        <tr>
          <td colspan="2">Total users</td>
          <td class="text-right">{{ qty_users }}</td>
        </tr>
      </table>
    </div>

    <div class="col-sm-6">
      <table class="table table-striped table-bordered table-hover">
        <tr>
          <td>Buggies uploaded</td>
          <td class="text-right">
            {% if qty_students > 0 %}
              {{ (100 * qty_buggies/qty_students) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_buggies }}</td>
        </tr>
        <tr>
          <td>Uploaded today</td>
          <td class="text-right">
            {% if qty_students > 0 %}
              {{ (100 * qty_uploads_today/qty_students) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_uploads_today }}</td>
        </tr>
        <tr>
          <td>Uploaded in last 7 days</td>
          <td class="text-right">
            {% if qty_students > 0 %}
              {{ (100 * qty_uploads_week/qty_students) | int }}%
            {% endif %}
          </td>
          <td class="text-right">{{ qty_uploads_week}}</td>
        </tr>
      </table>

      <table class="table table-striped table-bordered table-hover">
        <tr>
          <td>Project deadline</td>
          <!-- "dedaline-container" is magic: js enhanced -->
          <td id="deadline-container">
            {% if  config['PROJECT_SUBMISSION_DEADLINE'] %}
              <span style="display:inline-block;margin-right:1em;">{{ config['PROJECT_SUBMISSION_DEADLINE'] | replace("T", " ") }}</span>
              <span id="deadline-countdown" style="display:inline-block" data-deadline="{{ config['PROJECT_SUBMISSION_DEADLINE'] }}"></span>
            {% else %}
              not set
            {% endif %}
          </td>
        </tr>
        <tr>
          <td>With report?</td>
          <td>
            {% if config['PROJECT_REPORT_TYPE'] == "" %}
              no
            {% else %}
              yes
              {% if config['PROJECT_REPORT_TYPE'] != "report" %}
                (as "{{ config['PROJECT_REPORT_TYPE'] }}")
              {% endif %}
            {% endif %}
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
{% endblock %}

