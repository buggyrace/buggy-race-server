{% extends "layout.html" %}
{% block content %}
{%include "admin/_nav.html" %}
<div class="container pb-5">
  <div class="row">
    <h1>Site/configuration settings</h1>
  </div>
  {% for group in groups %}
    <div style="border:1px solid gray;padding:0.5em 1em;margin-bottom:1em;background-color:#eee">
      <h3>{{ group | title }} settings</h3>
      <form action="{{ url_for('admin.settings') }}" method="post">
        {{ form.csrf_token }}
        <input type="hidden" name="group" value="{{ group }}"/>
        {% for name in groups[group] %}
          <div class="row" style="background-color:#fff;margin:1em 0">
            <div class="col-sm-3">
              <code>{{ name }}</code>
            </div>
            <div class="col-sm-4">
              <input type="hidden" name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-name" value="{{ name }}"/>
              {% if type_of_settings[name] == "bool" %}
                <select name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-value">
                  <option value="0" {% if settings[name] == "0" %} selected="selected" {% endif %}>No</option>
                  <option value="1" {% if settings[name] == "1" %} selected="selected" {% endif %}>Yes</option>
                </select>
              {% else %}
                <input name="{{ SETTING_PREFIX }}-{{ loop.index0 }}-value" 
                {% if type_of_settings[name] == "int" %}
                    type="number"
                {% else %}
                    type="text"
                {% endif %}
                {%if settings[name] %} value="{{ settings[name] }}" {% endif %}/>
              {% endif %}
            </div>
            <div class="col-sm-5">
              {{ descriptions[name] }}
              <br>
              default: <code>{{ pretty_default_settings[name] }}</code>
            </div>
          </div>
        {% endfor %}
        <input type="submit" class="btn btn-primary" value="Submit {{ group }} settings"/>
      </form>
    </div>
  {% endfor %}
  <div class="row">
    <p>
      These are settings that <em>should</em> be set in the config, i.e., 
      as environment variables. If you're running locally (e.g., in
      development), that probably means in an <code>.env</code> file (see   
      <code>/env.example</code>, which is the template). If you're running on
      Heroku, change these in the <em>settingsâ†’&nbsp;config&nbsp;vars</em>
      section.
    </p>
    <p>
      This page is just a sanity check: you can't change them here!
    </p>
    <p>
      Note that the tech notes, which are published at
      <code>GITHUB_PAGES_URL</code> by Jekyll/GitHub Pages, do not get their
      URL settings from the environment. Instead, look in
      <code>/docs/_config.yml</code> and check that the settings in there match
      with what you see here.
    </p>
  </div>
  <div class="row">
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th>Setting</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <code>INSTITUTION_SHORT_NAME</code>
          </td>
          <td>
            <code>{{ config['INSTITUTION_SHORT_NAME'] }}</code>
          </td>
        </tr>
        <tr>
          <td>
            <code>INSTITUTION_FULL_NAME</code>
          </td>
          <td>
            <code>{{ config['INSTITUTION_FULL_NAME'] }}</code>
          </td>
        </tr>
        <tr>
          <td>
            <code>INSTITUTION_HOME_URL</code>
          </td>
          <td>
            <code><a href="{{ config['INSTITUTION_HOME_URL'] }}"">{{ config['INSTITUTION_HOME_URL'] }}</a></code>
          </td>
        </tr>
        <tr>
          <td>
            <code>PROJECT_CODE</code>
          </td>
          <td>
            <code>{{ config['PROJECT_CODE'] }}</code>
          </td>
        </tr>
        <tr>
          <td>
            <code>PROJECT_SLUG</code>
          </td>
          <td>
            <code>{{ config['PROJECT_SLUG'] }}</code>
          </td>
        </tr>
        <tr>
          <td>
            <code>ADMIN_USERNAMES</code>
          </td>
          <td>
            <code>
              {% for u in config['_ADMIN_USERNAMES_LIST'] %}
                {{ u }}<br>
              {% endfor %}
            </code>
          </td>
        </tr>
        <tr>
          <td><code>REGISTRATION_AUTH_CODE</code></td>
          <td>
            {% if config['_HAS_AUTH_CODE']  %}
              <code>[redacted]</code> <em>(but set OK)</em>
            {% else %}
              <em>none set</em>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td><code>BUGGY_EDITOR_GITHUB_URL</code></td>
          <td><code><a href="{{ config['BUGGY_EDITOR_GITHUB_URL'] }}">{{ config['BUGGY_EDITOR_GITHUB_URL'] }}</a></code></td>
        </tr>
        <tr>
          <td><code>BUGGY_EDITOR_REPO_OWNER</code></td>
          <td><code>{{ config['BUGGY_EDITOR_REPO_OWNER'] }}</code></td>
        </tr>
        <tr>
          <td><code>BUGGY_EDITOR_REPO_NAME</code></td>
          <td><code>{{ config['BUGGY_EDITOR_REPO_NAME'] }}</code></td>
        </tr>
        <tr>
          <td><code>BUGGY_RACE_SERVER_URL</code></td>
          <td><code><a href="{{ config['BUGGY_RACE_SERVER_URL'] }}">{{ config['BUGGY_RACE_SERVER_URL'] }}</a></code></td>
        </tr>
        <tr>
          <td><code>GITHUB_PAGES_URL</code></td>
          <td><code><a href="{{ config['GITHUB_PAGES_URL'] }}">{{ config['GITHUB_PAGES_URL'] }}</a></code></td>
        </tr>
        <tr>
          <td><code>IS_PRETTY_USERNAME_TITLECASE</code></td>
          <td>
            <code>{{ config['IS_PRETTY_USERNAME_TITLECASE'] }}</code>
            <em>
              (example: <code>ada</code> is 
              {% if config['IS_PRETTY_USERNAME_TITLECASE'] %}Ada{% else %}ada{% endif %})
            </em>
          </td>
        </tr>
        <tr>
          <th colspan="2">
            Additional (required) user data fields
            <span style="font-weight:normal">
              (what you need typically depends on what you're using as "username")
            </span>
          </th>
        </tr>
        <tr>
          <td>Summary</td>
          <td>
            {%if config['_USERS_ADDITIONAL_FIELDNAMES'] %}
              <code>{{ config['_USERS_ADDITIONAL_FIELDNAMES'] | join(", ") }}</code>
            {% else %}
              <em>no additional fields enabled<em>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td><code>USERS_HAVE_EMAIL</code></td>
          <td>
            <code><a href="{{ config['USERS_HAVE_EMAIL'] }}">{{ config['USERS_HAVE_EMAIL'] }}</a></code>
          </td>
        </tr>
        <tr>
          <td><code>USERS_HAVE_ORG_USERNAME</code></td>
          <td>
            <code><a href="{{ config['USERS_HAVE_ORG_USERNAME'] }}">{{ config['USERS_HAVE_ORG_USERNAME'] }}</a></code>
          </td>
        </tr>
        <tr>
          <td><code>USERS_HAVE_FIRST_NAME</code></td>
          <td>
            <code><a href="{{ config['USERS_HAVE_FIRST_NAME'] }}">{{ config['USERS_HAVE_FIRST_NAME'] }}</a></code>
          </td>
        </tr>
        <tr>
          <td><code>USERS_HAVE_LAST_NAME</code></td>
          <td>
            <code><a href="{{ config['USERS_HAVE_LAST_NAME'] }}">{{ config['USERS_HAVE_LAST_NAME'] }}</a></code>
          </td>
        </tr>
        <tr>
          <th colspan="2">
            Social/external sites
          </th>
        </tr>
        {% for site in config['SOCIAL_LINKS'] %}
            <tr>
              <td>
                {% set i = "{}_".format(loop.index0) if loop.index0 %}
                <code>SOCIAL_{{ "{}_".format(loop.index0) if loop.index0 }}NAME/URL/TEXT</code>
              </td>
              <td>
                <strong>{{ site['NAME'] }}</strong> &rarr;
                <code><a href="{{ site['URL'] }}">{{ site['URL'] }}</a></code>
                <br>
                {{ site['TEXT'] }}
              </td>
            </tr>
        {% else %}
            <tr>
              <td><code>SOCIAL_NAME/URL/TEXT</code></td>
              <td>
                <em>None</em>
              </td>
            </tr>
        {% endfor %}
        <tr>
          <th colspan="2">
            Default race settings
          </th>
        </tr>
        <tr>
          <td><code>DEFAULT_RACE_LEAGUE</code></td>
          <td><code>{{ config['DEFAULT_RACE_LEAGUE'] }}</code></td>
        </tr>
        <tr>
          <td><code>DEFAULT_RACE_COST_LIMIT</code></td>
          <td><code>{{ config['DEFAULT_RACE_COST_LIMIT'] }}</code></td>
        </tr>
        <tr>
          <td><code>DEFAULT_RACE_IS_VISIBLE</code></td>
          <td><code>{{ config['DEFAULT_RACE_IS_VISIBLE'] }}</code></td>
        </tr>
        <tr>
          <td><code><del>DEFAULT_RACE_START</del></code></td>
          <td>
            <code>two minutes to midnight, tomorrow</code>
            <br>(you can't change this default: avoid it by always specifying
            a date when you make a new race)
          </td>
        </tr>
        <tr>
          <th colspan="2">
            GitHub Client: see
            <a href="https://docs.github.com/en/developers/apps/managing-github-apps">GitHub apps</a>
          </th>
        </tr>
        <tr>
          <td><code>GITHUB_CLIENT_ID</code></td>
          <td><code>{{ config['GITHUB_CLIENT_ID'] }}</code></td>
        </tr>
        <tr>
          <td><code>GITHUB_CLIENT_SECRET</code></td>
          <td>
            {% if config['GITHUB_CLIENT_ID'] %}
              <code>[redacted]</code> <em>{{ config['GITHUB_CLIENT_ID']|length }} chars</em>
            {% else %}
              <em>None</em>
            {% endif %}
          </td>
        </tr>
        <tr>
          <th colspan="2">
            Tech stuff
          </th>
        </tr>

        <tr>
          <td><code>BCRYPT_LOG_ROUNDS</code></td>
          <td><code>{{ config['BCRYPT_LOG_ROUNDS'] }}</code></td>
        </tr>
        <tr>
          <td><code>CACHE_TYPE</code></td>
          <td><code>{{ config['CACHE_TYPE'] }}</code></td>
        </tr>
        <tr>
          <td><code>DATABASE_URL</code>...</td>
          <td>
            <!-- truncated shows database type, no point showing details (e.g., password) -->
            <code>{{ config['DATABASE_URL'] | truncate(8, True, '...') }}</code>
          </td>
        </tr>
        <tr>
          <td><code>DEBUG</code></td>
          <td><code>{{ config['DEBUG'] or "(not set)" }}</code></td>
        </tr>
        <tr>
          <td><code>FORCE_REDIRECT_HTTP_TO_HTTPS</code></td>
          <td><code>{{ config['FORCE_REDIRECT_HTTP_TO_HTTPS'] }}</code> (not&nbsp;used)</td>
        </tr>
        <tr>
          <td><code>GUNICORN_WORKERS</code></td>
          <td><code>{{ config['GUNICORN_WORKERS'] }}</code></td>
        </tr>
        <tr>
          <td><code>LOG_LEVEL</code></td>
          <td><code>{{ config['LOG_LEVEL'] }}</code></td>
        </tr>
        <tr>
          <td><code>SEND_FILE_MAX_AGE_DEFAULT</code></td>
          <td><code>{{ config['SEND_FILE_MAX_AGE_DEFAULT'] }}</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

