<nav>
  <a href="{{ site.moodle_url }}/">Moodle</a> |
  <a href="{{ site.server_url }}/">race&nbsp;server</a> |
  <a href="{{ site.baseurl }}/">tech&nbsp;notes</a> |
  <a href="{{ site.baseurl }}/project/tasks">task&nbsp;list</a>&nbsp;|&nbsp;<a
  href="{{ site.baseurl }}/project/poster">poster</a>
  <hr>
</nav>
<style>
.btn-github{display: none;} /* link to private repo is confusing, so hide it */
footer { text-align:right;}
#academic, #academic-no {
  position:fixed;
  right:0;
  bottom:0;
  width:0;
  height:0;
  border-bottom:5em solid rgba(255,255,255,0.5);
  border-left:5em solid transparent;
}
#academic img {
    position:fixed;
    right:0.5em;
    bottom:0.5em;
    width:2.5em;
    cursor:pointer;
}
</style>
<script>
  
  // dynamically (JS) replace the CSS with fake-LaTeX styling so academics
  // are not startled by the jekyll-theme-hacker GH-pages/Jekyll design
  // -----
  // - force it with ?latex=1 (to set) or ?latex=0 to (to clear)
  // - choice persists
  // - to implement, add a toggle button
  //

  const FAKE_LATEX_ID = "latex";
  const FAKE_LATEX_CSS_URL = "https://latex.now.sh/style.css";

  let want_latex = getLatexChoice();
  let latex_match = location.search.match(/latex=(\d)/);
  if (latex_match) { // preference in the URL has priority when page load
    want_latex = latex_match[1] != '0';
  }
  setLatexChoice(want_latex);
  
  const academic_tag = document.createElement("div");
  academic_tag.id = "academic";
  const academic_btn = document.createElement("img");
  academic_btn.setAttribute("src", 
    "{{ site.baseurl}}/assets/img/academic" + (want_latex?"-cancel":"") + ".svg");
  academic_btn.addEventListener("click", function(){
    location.href = location.href.replace(/(\#|\?).*/, "")
      + "?latex=" + (want_latex? "0" : "1")
      +  location.hash;
  } );
  academic_tag.appendChild(academic_btn);
  document.body.appendChild(academic_tag);
  function getLatexChoice(){
    return localStorage.getItem(FAKE_LATEX_ID) === 'true';
  }

  function setLatexChoice(want_latex){
    localStorage.setItem(FAKE_LATEX_ID, want_latex);
    if (want_latex) {
      let head = document.getElementsByTagName('head')[0];
      let latex_link = document.createElement('link');
      latex_link.rel = 'stylesheet';
      latex_link.type = 'text/css';
      latex_link.href = FAKE_LATEX_CSS_URL;
      head.appendChild(latex_link);
      for (let i=0; i<document.styleSheets.length; i++) {
        // use hostname as a casual check that this is the native one
        if (document.styleSheets[i].href != undefined &&
          document.styleSheets[i].href.indexOf(location.hostname)>=0) {
          document.styleSheets[i].disabled = true;
        }
      }
    }
  }

</script>
