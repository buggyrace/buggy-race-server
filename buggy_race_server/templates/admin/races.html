{% extends "layout.html" %}
{% block content %}
{%include "admin/_nav.html" %}
<div class="container pb-5">
  <div class="row">
    <h1 class="col my-3">
      Races
    </h1>
  </div>
  <div class="row">
    <table class="col table table-striped table-bordered table-hover table-responsive bg-white">
      <thead>
        <tr>
          {% if current_user.is_administrator %}
            <th rowspan="2"></th>
          {% endif %}
          <th rowspan="2">Race<br>shown?</th>
          <th rowspan="2">Results<br>shown?</th>
          <th rowspan="2">Race start<br>(upload deadline)</th>
          <th rowspan="2">Title &amp;<br>Description</th>
          <th rowspan="2">Cost<br>limit</th>
          <th colspan="3" class="text-center">Buggies</th>
        </tr>
        <tr>
          <th>Entered</th>
          <th>Started</th>
          <th>Finished</th>
        </tr>
      </thead>
      <tbody>
        {% for race in races %}
          {% if race.start_at.date() == date_today %}
            <tr class="">
              <td colspan="9" class="text-center alert-success">
                &darr; This race is today! &darr;
              </td>
            </tr>
            {% endif %}
          <tr class="race-visible-{{ race.is_visible }}">
            {% if current_user.is_administrator %}
              <td>
                <a class="btn btn-outline-secondary btn-admin btn-sm" href="{{ url_for('race.edit_race', race_id=race.id) }}">Edit&nbsp;&rtri;</a>
              </td>
            {% endif %}
            <td class="bool-{{ race.is_visible | lower }}">
              {% if race.is_visible %}
                Yes
              {% else %}
                No
              {% endif %}
            </td>
            <td class="bool-{{ race.is_result_visible | lower }}">
              {% if race.is_result_visible %}
                Yes
              {% else %}
                No
              {% endif %}
            </td>
            <td>
              {{ race.start_at.strftime('%Y-%m-%d %H:%M') }}
            </td>
            <td>
              <div class="cell-title">
                {% if race.title %}<strong>{{ race.title }}</strong>{% else %}<em>Untitled</em>{% endif %}
              </div>
              {% if race.desc %}
                <div class="my-2 race-desc">{{ race.desc }}</div>
              {% endif %}
            </td>
            <td class="text-right">
              {{ race.cost_limit }}
            </td>
            {% if race.results_uploaded_at %}
              <td class="text-right">
                {{ race.buggies_entered }}
              </td>
              <td class="text-right">
                {{ race.buggies_started }}
              </td>
              <td class="text-right">
                {{ race.buggies_finished }}
              </td>
            {% else %}
              <td colspan="3" class="text-right">
                <a href="{{ url_for('race.upload_results', race_id=race.id) }}" class="btn btn-outline-secondary btn-admin btn-sm">Upload results &rtri;</a>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if current_user.is_administrator %}
    <div class="row">
      <div class="col my-3">
        <p class="btn-collection">
          <a href="{{ url_for('race.new_race')}}" class="btn btn-outline-secondary btn-admin">Add new race &rtri;</a>
        </p>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

